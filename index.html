<!DOCTYPE html>
<html>
	<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>title</title>
	<meta name="author" content="TikiMari">
	<meta name="description" content="Custom clothing">
	<meta name="keywords" content="clothing">
	<link rel="stylesheet" type="text/css" href="index.css">

	</style>
	</head>
	<body>

		<div id="menu-space"></div>
		<div id="design-space" class="wh100"></div>

		<script src="jquery-3.2.1.min.js" type="text/javascript"></script>
		<script src="datatree.js"></script>
		<script>
			$( document ).ready(function() {
				var menuItems = [];
				var menuTree = {};

				// Get URL
				var code = findGetParameter('design');
				if (!code) window.location.replace("?design=m0s0tt0");

				// For each character
				var combo = '';
				var lastTypeInt;
				for(var i = 0; i < code.length; i++) {

					// If type is same as last: add to combo construction
					var isInt = !isNaN(parseInt(code[i]));
					if (combo.length === 0 || lastTypeInt === isInt) {
						combo += code[i];
						lastTypeInt = isInt;
						continue;
					}
					// Otherwise the combo is done

					// combo is texture (cloth example)
					if (lastTypeInt) {

					}
					// combo is string (drawing)
					else {
						var des = datatree.designs[combo];
						
						// Add Menuitem
						if (!menuTree[des.category])
							menuTree[des.category] = [];
						menuTree[des.category].concat(des.children);
						for (var i = 0; i < des.children.length; i++) {
							var subDes = datatree.designs[des.children[i]];
							if (!menuTree[subDes.category])
								menuTree[subDes.category] = [];
							menuTree[subDes.category] = menuTree[subDes.category].concat(subDes.children);
						}

						// Add drawing
						$('#design-space').append('<img src="'+des.svgURL+'">');
						combo = '';
					}
				}

				// Display menu
				var menuHTML = "";
				var cats = Object.keys(menuTree);
				for (var i = 0; i < cats.length; i++) {
					menuHTML += "<p>"+cats[i]+"</p>";
					var items = menuTree[cats[i]];
					for (var j = 0; j < items.length; j++) {
						menuHTML += '<a target="_blank">'+items[i]+'</a><br>';
					}
				}
				document.getElementById('menu-space').innerHTML = menuHTML;

			});

			function designCodeToTree(code) {
				var designTree = {};
				var codeArray = designCodeToArray(code);
				var lastC = "";
				for (var i = 0; i < codeArray.length; i++) {
					var c = codeArray[i];
					if (c[0] === "<") {
						designTree[lastC].childrenActive = designCodeToTree(c.slice(1, c.length-1));
						i++;
					} else if (isNaN(parseInt(c))) {
						designTree[c] = datatree.designs[c];
						lastC = c;
					}
				}
				return designTree;
			}

			function designCodeToArray(code) {
				return code.split(/(\d|<.*>)/g).filter(Boolean); // filter removes empty strings
			}

			function designTreeToCode(dtree) {
				var code = "";
				var keys = Object.keys(dtree);
				for (var i = 0; i < keys.length; i++) {
					code += keys[i] + "0";
					var kids = dtree[keys].childrenActive;
					if (kids) {
						for (var j = 0; j < kids.length; j++) {
							code += "<";
							code += designTreeToCode(kids[j]);
							code += ">";
						}
					}
				}
				return code;
			}

			function findGetParameter(parameterName) {
				var result = null,
					tmp = [];
				location.search
					.substr(1)
					.split("&")
					.forEach(function (item) {
					  tmp = item.split("=");
					  if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
					});
				return result;
			}
		</script>

	</body>
</html>